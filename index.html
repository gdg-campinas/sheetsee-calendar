<!DOCTYPE html>
<html>
  <head>
    <link rel='stylesheet' type='text/css' href='http://fonts.googleapis.com/css?family=Libre+Baskerville:400,700,400italic'>
    <meta charset="utf-8">
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
    <script type="text/javascript" src="js/tabletop.js"></script>
    <script type="text/javascript" src='js/sheetsee.js'></script>
    <script type="text/javascript" src='js/table.js'></script>
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <link rel="stylesheet" type="text/css" href="css/mapbox.css">
  </head>
  <body>

  <h1>NodeSchool Events</h1>
  <div id="map"></div>
  <div id="calendar-goes-here"></div>
  <small>Add events to this <a href="https://docs.google.com/a/github.com/spreadsheet/ccc?key=0AuOjlXjUrSbAdE1XRFJkeEJZQ1NSelhILUR0NXdBWUE#gid=0&output=json" target="_blank">spreadsheet</a>. Visit the GitHub <a href="http://www.github.com/jlord/sheetsee-calendar">repository</a>.</small>

  </body>
    <script type="text/javascript">
    // https://docs.google.com/spreadsheets/d/e/2PACX-1vTuo8RiWML8bu2bT1yJ-2uZx7DI-OA_imLKy7iKhoZ6Z0DLih6kP8vnAtN1cdBiZYNHnEdkpm-LzYdC/pubhtml

    document.addEventListener('DOMContentLoaded', function() {
      var URL = "2PACX-1vTuo8RiWML8bu2bT1yJ-2uZx7DI-OA_imLKy7iKhoZ6Z0DLih6kP8vnAtN1cdBiZYNHnEdkpm-LzYdC"
      Tabletop.init( { key: URL, callback: makeThings, simpleSheet: true } )

      function makeThings(data) {
        // build the calendar
        generateCalendar(data)
        // add hexcolor to color map markers
        data = addHexcolor(data, "#ccf4ff")
        // make map
        var optionsJSON = ["name", "tickets", "startdate"]
        var template = "<p>{{startdate}} <a href='{{tickets}}'"
          + " target='_blank'>{{name}}</a><p>"
        var geoJSON = Sheetsee.createGeoJSON(data, optionsJSON)
        var map = Sheetsee.loadMap("map")
        Sheetsee.addTileLayer(map, 'examples.map-9ijuk24y')
        var markerLayer = Sheetsee.addMarkerLayer(geoJSON, map, template)
      }
    })

    function addHexcolor(data, color) {
      data.forEach(function(row) {
        row.hexcolor = color
      })
      return data
    }

  </script>
</html>
